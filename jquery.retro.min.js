(function(a){a.fn.retro=function(d){var o=a.extend({cur_number:1,max_number:"10",height:"80","font-size":"80",width:"50",margin:"5",persp:"80","border-radius":"10",year:2014,month:5,day:4,show_seconds:true,reflections:true,stack:true,seperator:"<div style='float:left' class='seperator'> : </div>",font:"Arial"},d);
var s=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");var p=new Date();var r=p.getYear();if(r<1000){r+=1900;}var c=p.getMonth();
var f=p.getDate();var e=p.getHours();var i=p.getMinutes();var m=p.getSeconds();var g=s[c]+" "+f+", "+r+" "+e+":"+i+":"+m;futurestring=s[o.month-1]+" "+o.day+", "+o.year;
dd=Date.parse(futurestring)-Date.parse(g);var k=Math.floor(dd/(60*60*1000*24)*1);var t=Math.floor((dd%(60*60*1000*24))/(60*60*1000)*1);var j=Math.floor(((dd%(60*60*1000*24))%(60*60*1000))/(60*1000)*1);
var q=(o.height-o["font-size"])/2;if(q<0){q=0;}var l=function(u,C){var z=u+"";z=z.length;var A=a();if(z<2){z=2;}for(var v=z;v>0;--v){var y=Math.floor(u/Math.pow(10,v-1));
var w;if(v==2&&u<10){y=0;w=0;console.log(y+" "+w);single_digit=false;}else{w=(y>0?y-1:h[C+v]);}var B=a('<div class="digit">').data("cur_digit",y).data("cur_pos",C+v).html('  <div class="back">'+w+'</div>					<div class="back-bottom">'+(y)+'</div>					<div class="top-half">					'+(y)+'</div>					<div class="bottom-half">'+w+'</div>					<div class="front">'+w+'</div>					<div class="shadow">					<div class="top"></div>					<div class="bottom"></div>					</div>');
u=u%Math.pow(10,v-1);A=A.add(B);}return A;};var b=function(u,w,v){u.find(".bottom-half").addClass("ready");u.addClass("flip");setTimeout(function(){u.find(".front").show();
u.find(".top-half,.bottom-half").css("opacity","0").removeClass("ready");u.removeClass("flip");setTimeout(function(){u.find(".top-half,.bottom-half").css("opacity",1);
u.find(".back-bottom, .top-half").text(w);u.find(".back, .bottom-half").text(v);u.find(".front").hide().text(v);},700);},300);};var h={sec1:9,sec2:5,min1:9,min2:5,hour1:9,hour2:5};
if(o.show_seconds==true){var n=Math.floor((((dd%(60*60*1000*24))%(60*60*1000))%(60*1000))/1000*1);}return this.each(function(){var v=a(this);v.append(l(k,"day"));
v.append(o.seperator);v.append(l(t,"hour"));v.append(o.seperator);v.append(l(j,"min"));if(o.show_seconds==true){v.append(o.seperator);v.append(l(n,"sec"));
}v.find(".digit").height(o.height+"px").width(o.width+"px").css({"font-size":o["font-size"]+"px","font-family":o.font,"line-height":o["font-size"]+"px","margin-right":o.margin+"px","-webkit-perspective":o.persp+"px","-ms-perspective":o.persp+"px","-moz-perspective":o.persp+"px",perspective:o.persp+"px"});
if(o.reflections==true){v.find(".digit").addClass("reflect");}if(o.stack==true){v.find(".back").addClass("stack");}v.find(".seperator").css({"margin-right":o.margin+"px","line-height":o["font-size"]+"px","font-size":o["font-size"]+"px"});
v.find(".bottom-half").css("top",(o.height/2)+"px");v.find(".back-bottom").css("top",(o.height/2)+"px");v.find(".back, .front, .shadow").css({"border-radius":o["border-radius"]+"px"});
v.find(".back, .front").css({"padding-top":q+"px"});v.find(".top-half").css({"border-top-left-radius":o["border-radius"]+"px","border-top-right-radius":o["border-radius"]+"px","padding-top":q+"px"});
v.find(".top").css({"border-top-left-radius":o["border-radius"]+"px","border-top-right-radius":o["border-radius"]+"px"});v.find(".back-bottom, .bottom-half, .shadow > .bottom").css({"border-bottom-left-radius":o["border-radius"]+"px","border-bottom-right-radius":o["border-radius"]+"px"});
var u=(o.show_seconds==true?1000:60000);setInterval(function(){v.find(".bottom-half").addClass("ready");v.find(".digit").each(function(){var x=(o.show_seconds==true?"sec1":"min1");
if(a(this).data("cur_pos")==x){var z=(a(this).data("cur_digit")>0?a(this).data("cur_digit")-1:h[a(this).data("cur_pos")]);var w=(z>0?z-1:h[a(this).data("cur_pos")]);
a(this).data("cur_digit",z);b(a(this),z,w);if(a(this).data("cur_digit")==h[a(this).data("cur_pos")]){var y=a(this).prev();while(y){cur_digit=(y.data("cur_digit"));
cur_next_digit=(cur_digit>0?cur_digit-1:h[y.data("cur_pos")]);y.data("cur_digit",cur_next_digit);if(y.data("cur_digit")==h[y.data("cur_pos")]){cur_next_digit=y.data("cur_digit")-1;
b(y,y.data("cur_digit"),cur_next_digit);y=y.prev();}else{cur_next_digit=(y.data("cur_digit")==0?h[y.data("cur_pos")]:y.data("cur_digit")-1);b(y,y.data("cur_digit"),cur_next_digit);
break;}}}}});},u);});};})(jQuery);