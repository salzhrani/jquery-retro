(function(d){d.fn.retro=function(i){var a=d.extend({cur_number:1,max_number:"10",height:"80",width:"50",margin:"5",persp:"80","border-radius":"value",year:2014,month:5,day:4,show_seconds:!0,reflections:!0,seperator:"<div style='float:left' class='seperator'> : </div>"},i),i="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),g=new Date,j=g.getYear();1E3>j&&(j+=1900);var n=g.getMonth(),o=g.getDate(),p=g.getHours(),q=g.getMinutes();if(!0==a.show_seconds)var l=g.getSeconds();l=i[n]+" "+o+", "+
j+" "+p+":"+q+":"+l;futurestring=i[a.month-1]+" "+a.day+", "+a.year;dd=Date.parse(futurestring)-Date.parse(l);var r=Math.floor(1*(dd/864E5)),s=Math.floor(1*(dd%864E5/36E5)),t=Math.floor(1*(dd%864E5%36E5/6E4)),k=function(c,a){var e;e=(c+"").length;var g=d();for(2>e&&(e=2);0<e;--e)var f=Math.floor(c/Math.pow(10,e-1)),f=d('<div class="digit">').data("cur_digit",f).data("cur_pos",a+e).html('  <div class="back">'+(0<f?f-1:h[a+e])+'</div>\t\t\t\t\t<div class="back-bottom">'+f+'</div>\t\t\t\t\t<div class="top-half">\t\t\t\t\t'+
f+'</div>\t\t\t\t\t<div class="bottom-half">'+(0<f?f-1:h[a+e])+'</div>\t\t\t\t\t<div class="front">'+(0<f?f-1:h[a+e])+'</div>\t\t\t\t\t<div class="shadow">\t\t\t\t\t<div class="top"></div>\t\t\t\t\t<div class="bottom"></div>\t\t\t\t\t</div>'),c=c%Math.pow(10,e-1),g=g.add(f);return g},m=function(a,b,e){a.find(".bottom-half").addClass("ready");a.addClass("flip");setTimeout(function(){a.find(".front").show();a.find(".top-half,.bottom-half").css("opacity","0").removeClass("ready");a.removeClass("flip");
setTimeout(function(){a.find(".top-half,.bottom-half").css("opacity",1);a.find(".back-bottom, .top-half").text(b);a.find(".back, .bottom-half").text(e);a.find(".front").hide().text(e)},700)},300)},h={sec1:9,sec2:5,min1:9,min2:5,hour1:9,hour2:5};if(!0==a.show_seconds)var u=Math.floor(1*(dd%864E5%36E5%6E4/1E3));return this.each(function(){var c=d(this);c.append(k(r,"day"));c.append(a.seperator);c.append(k(s,"hour"));c.append(a.seperator);c.append(k(t,"min"));!0==a.show_seconds&&(c.append(a.seperator),
c.append(k(u,"sec")));c.find(".digit").height(a.height+"px").width(a.width+"px").css({"font-size":a.height+"px","line-height":a.height+"px","margin-right":a.margin,"-webkit-perspective":a.persp,"-ms-perspective":a.persp,"-moz-perspective":a.persp,perspective:a.persp});!0==a.reflections&&c.find(".digit").addClass("reflect");c.find(".seperator").css({"margin-right":a.margin+"px","line-height":a.height+"px","font-size":a.height+"px"});c.find(".bottom-half").css("top",a.height/2+"px");c.find(".back-bottom").css("top",
a.height/2+"px");c.find(".back, .front, .shadow").css("border-radius",a.border_radius+"px");c.find(".top-half").css({"border-top-left-radius":a.border_radius+"px","border-top-right-radius":a.border_radius+"px"});c.find(".back-bottom, .bottom-half").css({"border-bottom-left-radius":a.border_radius+"px","border-bottom-right-radius":a.border_radius+"px"});setInterval(function(){c.find(".bottom-half").addClass("ready");c.find(".digit").each(function(){var b=a.show_seconds==true?"sec1":"min1";if(d(this).data("cur_pos")==
b){var b=d(this).data("cur_digit")>0?d(this).data("cur_digit")-1:h[d(this).data("cur_pos")],c=b>0?b-1:h[d(this).data("cur_pos")];d(this).data("cur_digit",b);m(d(this),b,c);if(d(this).data("cur_digit")==h[d(this).data("cur_pos")])for(b=d(this).prev();b;){cur_digit=b.data("cur_digit");cur_next_digit=cur_digit>0?cur_digit-1:h[b.data("cur_pos")];b.data("cur_digit",cur_next_digit);if(b.data("cur_digit")==h[b.data("cur_pos")]){cur_next_digit=b.data("cur_digit")-1;m(b,b.data("cur_digit"),cur_next_digit);
b=b.prev()}else{cur_next_digit=b.data("cur_digit")==0?h[b.data("cur_pos")]:b.data("cur_digit")-1;m(b,b.data("cur_digit"),cur_next_digit);break}}}})},!0==a.show_seconds?1E3:6E4)})}})(jQuery);